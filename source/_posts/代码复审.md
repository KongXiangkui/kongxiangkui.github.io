---
title: 代码复审
date: 2020-05-09 19:55:13
tags:
categories:
- 软件工程
toc: true
---
代码复审：检查代码是否在代码规范的框架内正确地解决了问题
- 自我复审
- 同伴复审
- 团队复审

<!-- more -->

代码复审的目的：
- 找出代码的错误：编码错误和不符合规范的地方
- 发现逻辑错误
- 发现算法的错误，使用的算法不够优化
- 发现潜在的错误和回归性错误——当前的修改导致以前修复的缺陷又重新出现
- 发现可能改进的地方
- 互相学习以及熟悉项目的各个部分

## 过程

复审前：
- 代码必须成功编译，并使用团队规定的最严格的编译警告等级
- 程序员必须测试过代码，最好是单步执行过

复审中，开发者必须让所有问题得到满意的解释或解答

复审的结果，双方必须达成一致的意见
- 打回去：发现致命问题
- 有条件同意，发现小问题，问题得到解决或记录之后，代码可以签入，不需要再次复审
- 放行

更长远的考虑：

- “你这样修改了之后，有没有别的功能会受影响?”
- “项目中还有别的地方需要类似的修改么?”
- “有没有留下足够的说明，让将来维护代码时不会出现问题？”
- “对于这样的修改，有没有别的成员需要告知?”
- “导致问题的根本原因是什么？我们以后如何能自动避免这样的情况再次出现？”

代码复审要有核查表：

 

1．概要部分

（1）代码能符合需求和规格说明么？

（2）代码设计是否有周全的考虑？

（3）代码可读性如何？

（4）代码容易维护么？

（5）代码的每一行都执行并检查过了吗？

2．设计规范部分

（1）设计是否遵从已知的设计模式或项目中常用的模式？

（2）有没有硬编码或字符串/数字等存在？

（3）代码有没有依赖于某一平台，是否会影响将来的移植（如Win32到Win64）？

（4）开发者新写的代码能否用已有的Library/SDK/Framework中的功能实现？在本项目中是否存在类似的功能可以调用而不用全部重新实现？

（5）有没有无用的代码可以清除？（很多人想保留尽可能多的代码，因为以后可能会用上，这样导致程序文件中有很多注释掉的代码，这些代码都可以删除，因为源代码控制已经保存了原来的老代码。）

3．代码规范部分

（1）修改的部分符合代码标准和风格么（详细条文略）?

4．具体代码部分

（1）有没有对错误进行处理？对于调用的外部函数，是否检查了返回值或处理了异常？

（2）参数传递有无错误，字符串的长度是字节的长度还是字符（可能是单/双字节）的长度，是以0开始计数还是以1开始计数？

（3）边界条件是如何处理的？Switch语句的Default是如何处理的？循环有没有可能出现死循环？

（4）有没有使用断言（Assert）来保证我们认为不变的条件真的满足？

（5）对资源的利用，是在哪里申请，在哪里释放的？有没有可能导致资源泄露（内存、文件、各种GUI资源、数据库访问的连接，等等）？有没有可能优化？

（6）数据结构中是否有无用的元素？

5．效能

（1）代码的效能（Performance）如何？最坏的情况是怎样的？

（2）代码中，特别是循环中是否有明显可优化的部分（C++中反复创建类，C#中 string 的操作是否能用StringBuilder 来优化）？

（3）对于系统和网络调用是否会超时？如何处理?

6．可读性

代码可读性如何？有没有足够的注释？

7．可测试性

代码是否需要更新或创建新的单元测试？

还可以有针对特定领域开发（如数据库、网页、多线程等）的核查表。