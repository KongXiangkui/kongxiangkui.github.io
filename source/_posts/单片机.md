---
title: 单片机
date: 2020-03-13 15:11:34
tags: 
- 嵌入式
categories:
- [嵌入式]
toc: true
---
本文介绍单片机的相关概念和知识
<!--more-->
## 嵌入式学习流程

1. C语言，模电，数电
2. CPU架构：使用数电模块搭建一个CPU(CPU就是一特殊的时序逻辑电路)
3. 学习计算机体系结构，了解多线程、并行计算、各类指令集的执行方式
4. 学习片上系统Soc
5. 学习操作系统，开始编写BIOS和外部固件，使用C实现一个类Linux操作系统
6. 学习单片机，进行操作系统的移植

## 嵌入式硬件基础及裸机程序开发

知识点
- arm处理器基础，工作模式，寄存器，终端与异常，寻址方式，汇编指令集
- ADS集成开发环境
- 裸机程序开发：LED，串口，LCD，触摸屏，NANDFLASH，IIC，IIS，DMA等
  
 > 参考资料:
 > - ARM嵌入式基础教程：ARM基础知识
 > - 嵌入式Linux应用开发完全手册

## Linux

### Linux基础及Shell编程

 知识点
 - 常用命令及shell脚本
 - vim

### Linux应用程序基础开发

 知识点
 - GCC、GDB、Make基础
 - 文件、时间编程
 - 多进程、多线程程序设计
 - 进程间通信

> 参考资料:
> - 嵌入式Linux应用开发标准教程
> - UNIX高级环境教程

### Linux驱动程序

知识点
- Linux设备驱动基础知识
- 完成实验例程
- 编程习惯统一，文档规范
- 阅读海量代码
- 试验

> 参考资料
> - 深入理解Linux内核

## 嵌入式系统 Embedded System

嵌入式系统模型 Embedded System Model：应用软件层（可选） 系统软件层（可选)  硬件层

- 硬件:电路
- 软件:驱动程序device driver、嵌入式操作系统、应用软件

嵌入式操作系统：使os上层软件的开发简单；管理系统硬件和软件资源，确保系统操作更加安全可靠——进程管理、内存管理、I/O系统管理内核

> 中间层：位于设备驱动层之上/OS层之上/和OS层结合在一起，如：网络中间件驱动程序
        通用中间层——虚拟机
        特定市场的中间层

- 创建体系结构：设计嵌入式系统
- 实现体系结构：开发
- 测设系统：发现并解决问题
- 维护系统：投入运行，技术支持

定义系统——创建体系结构和编写文档
1. 坚实的技术支持
2. 理解体系结构：收集需求-> 选择硬件 -> 性能、安全性、可测性分析
3. 定义体系结构模式和参考模型：软硬件选择、编程语言选择、操作系统选择
4. 定义体系结构性结构：划分为多个结构
5. 编写体系结构文档：总的概括；为每一个结构编写一个文档——统一建模语言UML、属性驱动设计ADD；体系结构词汇表

分析和评估体系结构

设计的实现
目标机（设计中的嵌入式系统）和主机
    实用工具：编辑器、VCS、烧录器
    翻译工具：预处理器、解释器、编译器、链接器
    调试工具
    集成开发环境IDE
    仿真器emulator

质量保证和测试

### uCOSII操作系统
 
知识点
- 嵌入式实时操作系统基础
- uCOSII源代码阅读
- 移植uCOSII
- uCOSII应用程序开发

> 参考资料
> - 嵌入式实时操作系统uCOSII：对源代码的详细分析，主要学习操作系统的知识

## 文件系统
 
知识点
- Linux文件系统
- 熟悉busybox使用及Linux系统启动过程
- 构建自己的根文件系统

> 参考资料
> - 构建嵌入式Linux系统

### 嵌入式图形界面
 
知识点
- 嵌入式图形界面基础（GUI种类及比较）
- minigui基础知识
- minigui移植与程序编写

### bootloader学习
 
知识点
- bootloader基础知识
- u-boot基础和命令
- u-boot移植

> 参考资料
> - 参开手册u-boot

## 单片机发展趋势

1. CPU：增加数据总线的宽度；采用双CPU
2. 存储器：片内程序普遍采用Flash存储器（读写操作方便，掉电数据不丢失）；加大片内数据存储器的存储容量
3. 片内I/O：增加并行口的驱动能力，以减少外部驱动芯片（直接驱动LED和荧光显示屏VFD）；增加特殊的串行I/O功能（for构成分布式、网络化系统）；引入数字交叉化开关，改变以往片内外设与外部I/O引脚固定对应关系
4. 低功耗：目前均采用CMOS化芯片
5. 外围电路内装化：系统的“单片化”，一块芯片即一个系统
6. 编程简单化：目前大多数支持在线编程即系统编程ISP（In System Program）通过ISP下载线，把仿真调试过的代码写入单片机，省区编程器；部分支持在线应用编程IAP，可在线升级或销毁单片机应用程序，省去仿真器
7. 实时操作系统的使用：RTX51是一个针对8051的多任务内核

- 8051
 MCS-51(Intel):
 基本型：8031、8051、8751（对应低功耗型80C31、80C51、87C51；C 表示CMOS工艺）
 增强型（52子系列）：8032、8052、8752

 （Intel 转让 8051的内核技术 到ATMEL、Pilips、Cygnal、ADI……）
 （ATMEL的Flash存储技术与Intel 8051内核交换，并结合二者）

 AT89C5x/AT89S5x（ATMEL）：带有Flash存储器，增加了看门狗定时器WDT、ISP及SPI串行接口等，支持两种节电方式（8表示单片，9表示内部含有Flash存储器，C表示CMOS产品；LV低电压；S表示含有串行下载的Flash存储器)

 衍生品种：STC系列、C8051Fxxx、ADuC812等

- PIC系列：
 （Microchip）：PIC10F322（最小单片机，6引脚）、PIC18系列（中档）、PIC17Cxx（高档）
 采用RISC精简指令集，执行效率高，数据总线和控制总线分离（哈佛结构），具有单字长特性且允许代码位数多余8位（相比CISC可达2：1压缩，速度提高）
 引脚通过限流电阻可直接接220v交流电，无需光电耦合隔离

- AVR系列 （ATMEL）：
 Tiny系列（Tiny11/12/13/15等，低档）、AT90S系列（AT90S1200/2313/8515/8535等，中档）、Atmega系列（AT mega8/16/32/128以及AT mega8515/8535等，高档）
 RISC，以字长作为指令长度单位，指令长度固定。实现流水作业；
 Flash存储器；
 外设丰富：定时器/计数器、看门狗电路、低电压检测电路BOD、多个复位源；可设置启动后延时运行程序，可靠；片内有通用的异步串行通信UART、面向字节的高速硬件串口TWI、SPI串口
 I/O功能强、驱动能力大
 低功耗：省电功能Power Down 及休眠功能Idle的工作方式
 支持在线编程ISP

- 嵌入式DSP处理器：
    DSP：Digital Signal Processor数字信号处理器：高速实现数字信号的处理运算（乘法器）——数字滤波、FFT、频谱分析
    TMS320系列（TI，Texas Instruments）：TMS320C10

- CPU ==> 嵌入式微处理器Embedded MicroProcessor Unit，EMPU            （狭义的嵌入式系统）
    ARM系列：ARM7、ARM9、ARM9E、ARM10、SecurCore
    可以配置实时多任务操作系统RTOS：Linux、VxWorks、uC-OSII

> 微处理器：通用微处理器，Intel的x86系列(8086,80386,奔腾) 或者 MOtorola的680x0系例(68000,68010,68020)，不包括RAM，ROM，I/O端口

> 微控制器：含有CPU和固定的RAM，ROM，I/O端口，定时器，并且一起嵌入单一的芯片，部分厂商把ADC和其他外围电路也集成到芯片上

单片机选择原则：

1. 满足手头任务：
    速度（晶振频率）
    封装形式（空间布局，加工组装）
    功耗
    RAM和ROM的容量
    I/O引脚数量和芯片定时器数量
    可升级性
    成本
2. 开发环境：编译器，汇编器，调试器，烧录器，技术支持
3. 质量可靠性

### STM32

STM32F407ZGT6

> Datasheet
> 开发板原理图

- 内核：32位，ARM Cortex-M4处理器
- 时钟 高达168M
- 支持FPU（floating point unit浮点运算）和单周期DSP指令
  
- IO口：144个引脚，114个IO，大部分IO口耐5V（模拟通道除外），支持调试SWD和JTAG
- 存储器容量：1024K Flash，192K SRAM
- 时钟、复位和电源管理
- 低功耗：睡眠、停止、待机三种低功耗模式；可用电池为RTC和寄存器供电
- AD和DA
- DMA
- 定时器
- 通信接口
  
- 90nm的NVM工艺
- ART，Adaptive Real-Time Memory Accelerator自适应实时存储器加速器：使程序零等待执行，可达到210DMIPS@168MHz
- 多重AHB总线矩阵和多通道DMA,支持程序执行和数据传输并行处理

STM32最小系统：供电、复位、时钟（外部晶振2个）、Boot起动模式选择、下载电路（串口/JTAG/SWD）、后备电池

## 应用

- LED(Light-Emitting Diode Light)
 可以显示数字、字符、图形，而LED只能显示数字和字符
 LCD可整合刷新控制器，减轻CPU刷新LCD的任务，而LED必须使用CPU刷新（或其他方式）显示数据
 减轻字符和图形的编程难度

- LCD(Liquid Crystal Display)
 本身不发光，靠调制外界光来实现显示
 LCD显示模块LCM——把LCD显示器、背景光源、驱动器、控制器等部件通过印刷电路板制造为一个整体，作为一个独立的模块使用（功能强，易于控制，接口简单）
 引脚(Vss,Vcc,V0,RS,R/W，E，DB0~DB7) --->  LCD控制器  --->  LCD驱动器  --->  LCD显示器

- 直流电机的脉宽调制
 电机的速度取决于三个因素：负载，电压，电流
 固定的负载可以通过脉宽调制（pluse width modulation,PWM)保持速度平稳。通过改变（调制）供给直流电机脉冲的宽度，能增加或减少电机的
 输入功率，从而改变电机的速度。
