---
title: 代码规范
date: 2020-05-09 19:04:12
tags:
- 代码规范
categories:
- 软件工程
toc: true
---
代码规范包括：
- 代码风格规范：程序书写的格式问题，即文字上对缩进、变量名等的规范（要求：简明、易读、无二义性）
- 代码设计规范：程序设计、模块之间的关系，设计模式等，大多与语言特性有关。

> 参考：[邹欣-现代软件工程讲义3 代码规范和代码复审](https://www.cnblogs.com/xinz/archive/2011/11/20/2255971.html)

<!-- more -->

## 代码风格规范

1. 缩进：使用4个空格（可以在编辑器中定义Tab扩展为几个空格键，避免在不同情况下显示不同的长度）
2. 行宽：80字符宽（现在100字符宽也可以）
3. 括号：在复杂的表达式用括号清楚的表示逻辑优先级
4. 断行与空白的{}行

```C
if (condition) {
    DoSomethings();
}
else
{
    DoSomethingElse();
}
```

5. 分行：不要把多行语句放在一行上；不要把不同的变量定义在一行上
6. 命名

- 匈牙利命名法：在变量前面加入有意义的前缀，可以之间看出变量的类型及相应的语义（在强类型语言中，不建议使用）
- Pascal格式：所有单词的第一个字母大写
- Camel格式（lowCamel）：第一个单词全部小写，随后单词随Pascal格式

一个通用的做法：

- 所有的类型/类/函数名采用Pascal格式，所有的变量用Camel格式
- 类/类型/变量：名词或组合名词，如Member、ProductInfo等
- 函数：动词或动宾组合词，如get/set；RenderPage()

7. 注释

- 注释不是解释程序怎么工作的，因为程序本身可以说明这一问题。注释用于解释程序是做什么的，位深这么做。
- 复杂的注释应该放在函数头，很多函数头的注释都是解释参数的类型的，如果程序的正文能够说明参数类型，就不要重复。
- 注释要随着程序的修改而不断更新
- 注释及源代码应该只用ASCII码，不要用中文或其他字符，会极大的影响程序的可移植性


## 代码设计规范

### 函数Function, Method

只做一件事，但要做好

关于goto的使用：
程序最好只有单一的出口，为了达到这一目的，可以使用goto。只要有助于程序逻辑的清洗体现，什么方法都可以使用。

```C
MyFunType func()
{
    if (SomeCode() != OK) 
    {
        goto Error;
    }
    ...
    Error: //clean up
    return Value;
}
```

### 错误处理

> 80%的程序代码都是对各种已经发生和可能发生的错误的处理

1. 参数处理
所有的参数都要验证其正确性
2. 断言Assert
如果你觉得某事肯定如何，你可以使用断言；如果你任某时可能会发生，就是用错误处理

## 如何处理C++中的类

一些常见的C++规范：

- [Google C++规范](https://google.github.io/styleguide/cppguide.html )
- [C++之父主导的规范](https://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines  )

### 类

1. 使用类来封装面向对象的概念和多态
2. 避免传递类型尸体的值，应该用指针传递。（对于简单的数据类型，没有必要使用类来实现）
3. 对于有显式的构造和析构函数，不要建立全局的实体，因为你不知道他们在何时创建和消除

### Class VS. Struct

如果只是数据的封装，使用struct

### 公共/保护/私有成员Public，Private，Protected

按照public，private，protected的顺序来说明类中的成员

### 数据成员

### 虚函数Virtual Functions

- 使用虚函数来实现多态
- 直在非常必要的时候才使用虚函数
- 入伙一个类型要实现多态，在基类Base Class中的析构函数也应该是虚函数

### 构造函数Contructors

- 不要再构造函数中做复杂的操作，简单初始化所有的数据成员即可
- 构造函数不应该也不能返回错误

### 析构函数

- 把所有的清理函数都放在析构函数中，如果有些资源在析构函数之前就释放了，记住要重置这些成员为0或NULL
- 析构函数不应该返回错误

### new和delete

- 如果可能，实现自己的New/Delete，方便加上自己的跟踪和管理极值
- 检查New的返回值，New不一定成功
- 释放指针时不用检查NULL

### 运算符Operators

- 在理想状态下，我们定义的类不需要自定义操作符。只有当操作符的确需要时。
- 运算符不要做标准语义之外的任何动作。例如，“==”的判断不能改变被比较实体的状态。
- 运算符的实现必须非常有效率，如果有复杂的操作，应定义一个单独的函数。
- 当你拿不定主意的时候，用成员函数，不要用运算符。

### 异常Exceptions

- 异常是在“异乎寻常”的情况下出现的，它的设置和处理都要花费“异乎寻常”的开销，所以不要用异常作为逻辑控制来处理程序的主要流程。
- 了解异常及处理异常的花销，在C++语言中，这是不可忽视的开销。
- 当使用异常时，要注意在什么地方清理数据。
- 异常不能跨过DLL或进程的边界来传递信息，所以异常不是万能的。

### 类型继承Class Inheritance

- 当有必要的时候，才使用类型继承。

- 用Const标注只读的参数（参数指向的数据是只读的，而不是参数本身）。
- 用Const标注不改变数据的函数

